// https://blog.risingstack.com/d3version4-js-tutorial-bar-charts-with-javascript/
"use strict";


var thread_cache;
d3version4.csv("data/data_w_body.csv", render);

function restore_dataset(){
  thread_cache = d3version4.csv("data/data_w_body.csv", render);
}

//Respond to Change in Date Slider
//this slider should never filter the global data set "thread_cache" only pcp filter should
$("#date_slider").bind("valuesChanged", function(e,d) {
  // console.log("RANNNNN");
  //pc.brushReset();
  render(thread_cache);
});

function render(data) {
  // console.log(data);
  var startDate = $("#date_slider");
  var endDate = $("#date_slider");
  startDate = startDate.dateRangeSlider("values").min;
  endDate = endDate.dateRangeSlider("values").max;

  $('#remove_filters_button')
    .attr('class', 'btn btn-outline-dark')
    .text('REMOVE ALL PCP FILTERS');

  thread_cache = data;

//thread_id,resolution_status,number_replies,symptoms,startDate,endDate,duration,malware
  var threads = data.filter(row => {
    let date = new Date(row.startDate);
    // console.log(date,startDate,date >= startDate)
    return date >= startDate && date <= endDate;
  });
  // console.log(threads);
  if(threads == false){
    $('#remove_filters_button')
      .attr('class', 'btn btn-danger')
      .text('NO RESULTS - SLIDE DATE BACK OR CLICK TO REMOVE FILTERS');

   return render_no_pcp;
  };

  drawPCP(threads);
  drawresolved(threads);
  barchart(threads);
  linechart(threads);
  drawWordCloud(threads);
  scatter(threads);
}

function render_no_pcp(threads) {
//replaces thread_cache w/ only pcp filtered data (threads)
  thread_cache = threads;
//then runs the charts with this data
  drawresolved(threads);
  barchart(threads);
  linechart(threads);
  drawWordCloud(threads);
  scatter(threads);
}
